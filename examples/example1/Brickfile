@modules nvhpc-hpcx-cuda12/25.5
@env PATH:/mnt/opt/gcc/15.1.0/bin

@source gh:UK-SCC/Cy4Shot:81972389e187fab1
@dep lua

mkdir -p build
cd build
LDFLAGS="-lzip -lcurl" cmake ../ \
    -DHOST_ARCH=skx \
    -DCMAKE_BUILD_TYPE=Release \
    -DDEVICE_BACKEND=cuda \
    -DDEVICE_ARCH=sm_90 \
    -DNUMA_AWARE_PINNING=ON \
    -DASAGI=ON \
    -DGEMM_TOOLS_LIST=LIBXSMM,PSpaMM \
    -DPRECISION=double \
    -DORDER=4 \
    -DEQUATIONS=elastic \
    -DR_QUAD_RULE=dunavant \
    -DPLASTICITY_METHOD=nb \
    -DLTO=OFF \
    -DGRAPH_PARTITIONING_LIBS=parmetis \
    -DCMAKE_INSTALL_PREFIX=$SEISSOL_INSTALL_DIR

make -j$(nproc)
make install
